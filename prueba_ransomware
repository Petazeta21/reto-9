import tkinter as tk
import os
import time

# Ruta con archivos de prueba
RUTA_OBJETIVO = os.path.expanduser("~/ransom_prueba")
CLAVE_CORRECTA = "petazeta21"

# Simula el cifrado renombrando archivos y sobreescribiendo su contenido
def cifrar_archivos():
    if not os.path.exists(RUTA_OBJETIVO):
        os.makedirs(RUTA_OBJETIVO)
        for i in range(5):
            with open(os.path.join(RUTA_OBJETIVO, f"documento{i}.txt"), "w") as f:
                f.write(f"Este es un archivo de prueba {i}\n")

    for archivo in os.listdir(RUTA_OBJETIVO):
        path = os.path.join(RUTA_OBJETIVO, archivo)
        if os.path.isfile(path) and not path.endswith(".locked"):
            with open(path, "w") as f:
                f.write("Tus archivos han sido cifrados por Petazeta21 :)")
            os.rename(path, path + ".locked")

# Simula el descifrado restaurando los nombres de archivo
def descifrar_archivos():
    for archivo in os.listdir(RUTA_OBJETIVO):
        path = os.path.join(RUTA_OBJETIVO, archivo)
        if path.endswith(".locked"):
            nuevo = path.replace(".locked", "")
            with open(nuevo, "w") as f:
                f.write("Archivo restaurado. Gracias por colaborar.\n")
            os.remove(path)

# Interfaz gráfica
class RansomwareSimulador:
    def __init__(self, root):
        root.title("Petazeta21 - Simulador de Ransomware")
        root.geometry("400x200")
        tk.Label(root, text="Tus archivos han sido cifrados", fg="red", font=("Arial", 16)).pack(pady=10)
        tk.Label(root, text="Introduce la clave para restaurarlos:").pack()

        self.entrada = tk.Entry(root, show="*")
        self.entrada.pack(pady=5)
        tk.Button(root, text="Desbloquear", command=self.verificar_clave).pack(pady=5)
        self.estado = tk.Label(root, text="", fg="blue")
        self.estado.pack(pady=10)

    def verificar_clave(self):
        if self.entrada.get() == CLAVE_CORRECTA:
            self.estado.config(text="✔ Archivos restaurados correctamente.")
            descifrar_archivos()
        else:
            self.estado.config(text="❌ Clave incorrecta. Prueba otra vez.")

if __name__ == "__main__":
    cifrar_archivos()
    ventana = tk.Tk()
    app = RansomwareSimulador(ventana)
    ventana.mainloop()
